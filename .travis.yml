language: node_js
node_js:
  - "10"

cache:
  directories:
    - node_modules

branches:
  only: 
    - master

jobs:
  include:
    - stage:
      name: build
      script:
        - node ./deploy/patch-version.js
        - yarn
        - yarn global add webpack-cli@3.1.2 webpack@4
        - yarn build
        - yarn build-examples
        - yarn test
      deploy:
        provider: npm
        skip_cleanup: true
        email: $NPM_EMAIL_ADDRESS
        api_key: $NPM_AUTH_TOKEN
        on:
          branch: master
